# План имплементации typemon

## Обзор проекта

**typemon** — параметрический генератор корпусов для сплит-эргоклавиатур на Choc-свитчах. Проект использует YAML-конфигурацию для описания геометрии и Go-утилиту для генерации OpenSCAD-моделей.

## Этапы разработки

### Этап 1: Базовая инфраструктура ✅

- [x] Инициализация Go-модуля
- [x] Определение структуры YAML-конфигурации
- [x] Реализация парсера конфигурации в Go (`internal/config/`)
- [x] Создание базового CLI с командами `generate` и `render`
- [x] Создание примера конфигурации (`configs/default.yml`)

### Этап 2: Генерация основной поверхности keywell ✅

- [x] Реализация базовой геометрии keywell (сферическая проекция)
- [x] Генерация позиций клавиш с учётом per-finger offsets
- [x] Реализация непрерывной плоскости через hull-операции по окнам 2×2
- [x] Применение базового угла наклона основной поверхности
- [x] Создание модулей для работы с матрицами трансформации (`scad/modules/matrix.scad`)

### Этап 3: Кластеры больших пальцев ✅

- [x] Реализация позиционирования кластера относительно origin-ключа
- [x] Применение углов поворота плоскости большого пальца
- [x] Генерация клавиш большого пальца с локальными смещениями
- [x] Поддержка 5-way кнопки в кластере
- [x] Соединение кластера с основной плоскостью через hull

### Этап 4: Детализация корпуса (в процессе)

- [x] Реализация внутренней губы (inner lip) для keywell
- [x] Реализация внешней губы (outer lip) для keywell
- [x] Реализация стенок
        - [x] Проекция границ на xy
        - [x] Задняя\Внешняя\внутренняя
        - [?] Передняя(требует уточнения\декомпозиции, может быть в свой этап, а может просто не нужна)
- [ ] Генерация места под контроллер
- [x] Вынести генерацию негатива для вырезов посадочных мест под свитчи, сделать негатив под choc(или mx)
- [ ] Посадочные места под модульные PCB с хотсвап-сокетами
- [x] Режим генерации зеркальной(правой) половины.
- [ ] Генерация нижней крышки (тоже сложный этап - возможно стоит вынести в отдельную итерацию и декомпозировать)

### Этап 5: Генерация через Go-шаблоны

- [x] Исправление существующего примера конфигурации на основе scad эскиза
- [x] Создание Go-шаблонов для генерации SCAD-файлов
- [x] Интеграция шаблонов в команду `generate`
- [?] Валидация конфигурации перед генерацией
- [x] Поддержка генерации для левой и правой половин

### Этап 6: Экспорт и рендеринг

- [ ] Реализация команды `render` для генерации STEP-файлов
- [ ] Интеграция с OpenSCAD CLI для экспорта STL
- [ ] Оптимизация качества рендеринга (`$fn`, `$fa`, `$fs`)

### Этап 7: Документация и примеры

- [x] Базовый README с описанием проекта
- [ ] Документация по параметрам конфигурации
- [ ] Примеры различных конфигураций
- [ ] Гайд по сборке и печати

### Этап 8: Тестирование и оптимизация

- [ ] Тестирование различных конфигураций
- [ ] Проверка геометрии на ошибки (non-manifold, self-intersections)
- [ ] Оптимизация производительности рендеринга
- [ ] Тестирование на реальной печати

### Этап 9: Трекпойнт и дополнительные элементы

- [ ] Интеграция трекпойнта в основную поверхность
- [ ] Генерация посадочного места под трекпойнт
- [ ] Поддержка дополнительных элементов (энкодеры, дисплеи и т.д.)

### Этап 10: Расширенные возможности

- [ ] Поддержка различных типов свитчей (не только Choc)
- [ ] Интеграция с QMK/ZMK для генерации конфигов прошивки
- [ ] Визуализация раскладки клавиш

## Текущий статус

**Завершено:**
- Базовая инфраструктура проекта
- Парсинг YAML-конфигурации
- Генерация основной поверхности keywell
- Генерация кластеров больших пальцев
- Система матриц трансформации
- Внутренняя губа keywell

**В работе:**
- Детализация корпуса (внешняя губа, дно, каналы для проводки)

**Запланировано:**
- Трекпойнт
- Генерация через Go-шаблоны
- Экспорт в STEP/STL
- Документация

## Технические детали

### Структура конфигурации

Основные секции конфига:
- `layout` — количество рядов/колонок, дополнительные клавиши
- `geometry` — углы наклона, кривизна keywell
- `columns_geometry` — смещения и наклоны по пальцам
- `thumb_clusters` — параметры кластеров больших пальцев
- `trackpoint` — параметры трекпойнта
- `pcbs` — параметры модульных PCB
- `render` — параметры рендеринга

### Матрицы трансформации

Проект использует систему матриц 4×4 для всех трансформаций:
- `Mtranslate(p)` — трансляция
- `Mrotate(r)` — поворот (Euler angles)
- `Mx/My/Mz(angle)` — повороты вокруг осей
- Композиция через умножение матриц

### OpenSCAD модули

Основные модули:
- `keywell_plane()` — основная плоскость keywell
- `keywell_switches()` — свитчи основной поверхности
- `thumb_plane()` — плоскость кластера большого пальца
- `thumb_plane_switches()` — свитчи большого пальца

## Приоритеты

1. **Высокий:** Завершение детализации корпуса (дно, каналы, крепления)
2. **Высокий:** Генерация через Go-шаблоны вместо ручного редактирования SCAD
3. **Средний:** Интеграция трекпойнта
4. **Средний:** Экспорт в STEP/STL
5. **Низкий:** Расширенные возможности и оптимизации

